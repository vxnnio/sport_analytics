<!-- athlete/view_evaluations.html -->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>評估紀錄</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>評估紀錄</h1>

    <a href="{{ url_for('evaluation.evaluation_form') }}" class="btn btn-primary">填寫今日評估</a>

    {% if records_data and records_data|length > 0 %}
    <canvas id="evaluationChart" width="800" height="400"></canvas>

    <script>
        // 後端 evaluation.py 準備好的乾淨資料
        const recordsData = {{ records_data|tojson }};
        console.log(recordsData);

        // 拆出各欄位
        const labels = recordsData.map(r => r.eval_date_str);
        const trainingStatus = recordsData.map(r => r.training_status);
        const fitness = recordsData.map(r => r.fitness);
        const sleep = recordsData.map(r => r.sleep);
        const appetite = recordsData.map(r => r.appetite);

        const data = {
            labels: labels,
            datasets: [
                {
                    label: 'Training Status',
                    data: trainingStatus,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.3
                },
                {
                    label: 'Fitness',
                    data: fitness,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    tension: 0.3
                },
                {
                    label: 'Sleep',
                    data: sleep,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    tension: 0.3
                },
                {
                    label: 'Appetite',
                    data: appetite,
                    borderColor: 'rgba(255, 206, 86, 1)',
                    backgroundColor: 'rgba(255, 206, 86, 0.2)',
                    tension: 0.3
                }
            ]
        };

        const config = {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: true, text: '評估分數折線圖' }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        };

        new Chart(document.getElementById('evaluationChart'), config);
    </script>
    {% else %}
        <p>尚無評估紀錄。</p>
    {% endif %}
</body>
</html>
